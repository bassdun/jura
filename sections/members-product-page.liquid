{% comment %}
  Members-Only Product Page Section for Vessel Theme
  Wraps the original product-information section with access control
  Integrates seamlessly with Vessel's block system
{% endcomment %}

{% unless customer %}
  {% comment %} Guest user - show access denied {% endcomment %}
  <div class="section section--full-width">
    <div class="page-width">
      <div class="access-denied">
        <div class="access-denied__content">
          <div class="access-denied__icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <circle cx="12" cy="7" r="4"></circle>
              <path d="M12 1v6"></path>
            </svg>
          </div>
          <h1 class="access-denied__title">{{ section.settings.access_title | default: 'Members-Only Access Required' }}</h1>
          <p class="access-denied__message">
            {{ section.settings.access_message | default: 'This is an exclusive members-only store. Please log in to view products and access special pricing.' }}
          </p>
          {% if section.settings.show_benefits %}
            <div class="access-denied__details">
              <h3>Member Benefits:</h3>
              <ul>
                <li>üè∑Ô∏è Exclusive member pricing up to 40% off</li>
                <li>üîê Access to special collections</li>
                <li>‚ö° Priority customer support</li>
                <li>üéÅ Member-only products</li>
              </ul>
            </div>
          {% endif %}
          <div class="access-denied__actions">
            <a href="/account/login?return_to={{ request.path | url_encode }}" class="button button--primary">
              {{ section.settings.login_text | default: 'Login to Continue' }}
            </a>
            <a href="/account/register" class="button button--secondary">
              {{ section.settings.register_text | default: 'Create Account' }}
            </a>
          </div>
          <p class="access-denied__note">
            <small>You will be redirected to the login page automatically.</small>
          </p>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.location.href = '/account/login?return_to=' + encodeURIComponent(window.location.pathname + window.location.search);
  </script>
  
  <noscript>
    <meta http-equiv="refresh" content="0;url=/account/login?return_to={{ request.path | url_encode }}">
  </noscript>

{% else %}
  {% comment %} Member is logged in - render the original product-information section {% endcomment %}
  {% section 'product-information' %}
{% endunless %}

{% schema %}
{
  "name": "Members Product Page",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "Access Control"
    },
    {
      "type": "text",
      "id": "access_title",
      "label": "Access Denied Title",
      "default": "Members-Only Access Required"
    },
    {
      "type": "textarea",
      "id": "access_message", 
      "label": "Access Denied Message",
      "default": "This is an exclusive members-only store. Please log in to view products and access special pricing."
    },
    {
      "type": "checkbox",
      "id": "show_benefits",
      "label": "Show Member Benefits",
      "default": true
    },
    {
      "type": "text",
      "id": "login_text",
      "label": "Login Button Text",
      "default": "Login to Continue"
    },
    {
      "type": "text", 
      "id": "register_text",
      "label": "Register Button Text",
      "default": "Create Account"
    }
  ]
}
{% endschema %}
